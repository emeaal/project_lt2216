(this.webpackJsonpspeechstate=this.webpackJsonpspeechstate||[]).push([[0],{170:function(t,e,n){},218:function(t,e){},357:function(t,e){},360:function(t,e){},364:function(t,e){},365:function(t,e){},366:function(t,e){},367:function(t,e){},368:function(t,e){},456:function(t,e,n){"use strict";n.r(e);var o=n(166),a=n(15),r=(n(170),n(14),n(159)),i=n(26),c=n(94),s=n(3),u=n(459),l=n(460),d=n.p+"static/media/forest.9e1b33fe.png",f=Object(s.q)((function(t){return{type:"SPEAK",value:"You're right. It does seem to be a ".concat(t.recResult[0].utterance)}}));function h(t){return Object(s.q)((function(e){return{type:"SPEAK",value:t}}))}function p(t){return{initial:"prompt",states:{prompt:{entry:h(t)}}}}function m(t){return{initial:"prompt",states:{prompt:{entry:h(t),on:{ENDSPEECH:"ask"}},ask:{entry:Object(s.q)("LISTEN")}}}}var g=["Sorry what did you say?","Sorry I didn't understand what you said","Could you repeat that?","Could you say that again, please?","What did you say?"],b=(Math.random,g[Math.floor(Math.random()*Math.floor(g.length))]),v={"It's a beach.":{beach:"beach"},"A beach":{beach:"beach"},"A forest":{forest:"forest"},"Forest.":{forest:"forest"},"It's a forest.":{forest:"forest"},"Help.":{help:"Help"},"Right.":{right:"right"},"Right?":{right:"right"},Left:{left:"left"},"Left?":{left:"left"},"Leave.":{leave:"leave"},"Money.":{money:"money"}},y={"Forest.":{forest:d}},E={initial:"idle",states:{idle:{on:{CLICK:"init"}},init:{on:{TTS_READY:"voicegameapp",CLICK:"voicegameapp"}},noMatch:{initial:"notmatched",states:{notmatched:{entry:h(b),on:{ENDSPEECH:"#root.dm.voicegameapp.histforask"}}}},getHelp:{initial:"helpmessage",states:{helpmessage:{entry:h("One thing that we actually have succeeded to implement at this moment is this help message"),on:{ENDSPEECH:"#root.dm.voicegameapp"}}}},endofgame:{initial:"end",states:{end:{entry:h("Game ended. Please play again if you'd like to"),on:{ENDSPEECH:"#root.dm.idle"}}}},voicegameapp:{initial:"welcome",states:{hist:{type:"history",history:"shallow"},histforask:{type:"history",history:"deep"},stop:{entry:h("Ok"),always:"#root.dm.idle"},welcome:Object(a.a)({initial:"prompt",on:{RECOGNISED:[{target:"forest",cond:function(t){return"forest"in(v[t.recResult[0].utterance]||{})},actions:Object(s.b)({forest:function(t){return y[t.recResult[0].utterance].forest}})},{target:"#root.dm.getHelp",cond:function(t){return"help"in(v[t.recResult[0].utterance]||{})}},{target:"#root.dm.noMatch"}],TIMEOUT:".."}},m("Welcome!")),forest:{initial:"sayforest",on:{RECOGNISED:[{target:"#root.dm.getHelp",cond:function(t){return"help"in(v[t.recResult[0].utterance]||{})}},{target:"right_cave",cond:function(t){return"right"in(v[t.recResult[0].utterance]||{})}},{target:"left_river",cond:function(t){return"left"in(v[t.recResult[0].utterance]||{})}},{target:"#root.dm.noMatch"}]},states:{sayforest:{entry:f,on:{ENDSPEECH:"tellforeststory"}},tellforeststory:Object(a.a)({},m("To your right a river is flowing, and to the left there's a cave. Where would you like to go?"))}},right_cave:Object(a.a)({},p("You get hit in the head with a bat. You're now dead. Turns out, the one you talked to was the second in command. The older brother wants people to recognise he's in charge and you upset him. Too bad.")),left_river:{initial:"cavestory",on:{RECOGNISED:[{target:"#root.dm.getHelp",cond:function(t){return"help"in(v[t.recResult[0].utterance]||{})}},{target:"#root.dm.endofgame",cond:function(t){return"leave"in(v[t.recResult[0].utterance]||{})}},{target:"offermoney",cond:function(t){return"money"in(v[t.recResult[0].utterance]||{})}},{target:"lookforacorns",cond:function(t){return"acorns"in(v[t.recResult[0].utterance]||{})}},{target:"#root.dm.noMatch"}]},states:{cavestory:Object(a.a)(Object(a.a)({},p("The troll tells you that for the small price of 10 acorns, they can let you inside the cave")),{},{on:{ENDSPEECH:"cavealternatives"}}),cavealternatives:Object(a.a)({},m("You can leave, offer them money instead or look for acorns"))}},offermoney:{initial:"promptmoney",states:{promptmoney:Object(a.a)(Object(a.a)({},p("You say you don\u2019t have acorns, but you have 10 euros in your pocket . The trolls laugh. You should go look for some acorns then")),{},{on:{ENDSPEECH:"#root.dm.voicegameapp.lookforacorns"}})}},lookforacorns:Object(a.a)({},p("You look for acorns"))}}}},S=n(160),O=n.n(S),j=n(163),k=n.n(j),C=n(12),R=(new URL("https://nordicforestresearch.org/wp-content/uploads/2020/05/forest-4181023_1280.jpg"),i.a.send),T=i.a.cancel,x="northeurope";Object(l.a)({url:"https://statecharts.io/inspect",iframe:!1});var w=Object(c.a)({id:"root",type:"parallel",states:{dm:Object(a.a)({},E),asrtts:{initial:"init",states:{init:{on:{CLICK:{target:"getToken",actions:[Object(s.b)({audioCtx:function(t){return new(window.AudioContext||window.webkitAudioContext)}}),function(t){return navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){t.audioCtx.createMediaStreamSource(e)}))}]}}},getToken:{invoke:{id:"getAuthorizationToken",src:function(t,e){return L()},onDone:{actions:[Object(s.b)((function(t,e){return{azureAuthorizationToken:e.data}})),"ponyfillASR"],target:"ponyfillTTS"},onError:{target:"fail"}}},ponyfillTTS:{invoke:{id:"ponyTTS",src:function(t,e){return function(e,n){var o=k()({audioContext:t.audioCtx,credentials:{region:x,authorizationToken:t.azureAuthorizationToken}}),a=o.speechSynthesis,r=o.SpeechSynthesisUtterance;t.tts=a,t.ttsUtterance=r,t.tts.addEventListener("voiceschanged",(function(){t.tts.cancel();var n=t.tts.getVoices(),o=RegExp("en-US","u");o=RegExp("en-US","u");var a=n.find((function(t){return/Christopher/.test(t.name)}));a?(t.voice=a,e("TTS_READY")):(console.error("TTS_ERROR: Could not get voice for regexp ".concat(o)),e("TTS_ERROR"))}))}}},on:{TTS_READY:"idle",TTS_ERROR:"fail"}},idle:{on:{LISTEN:"recognising",SPEAK:{target:"speaking",actions:Object(s.b)((function(t,e){return{ttsAgenda:e.value}}))}}},recognising:{initial:"noinput",exit:"recStop",on:{ASRRESULT:{actions:["recLogResult",Object(s.b)((function(t,e){return{recResult:e.value}}))],target:".match"},RECOGNISED:"idle",SELECT:"idle",CLICK:".pause"},states:{noinput:{entry:["recStart",R({type:"TIMEOUT"},{delay:function(t){return 500*(t.tdmPassivity||10)},id:"timeout"})],on:{TIMEOUT:"#root.asrtts.idle",STARTSPEECH:"inprogress"},exit:T("timeout")},inprogress:{},match:{entry:R("RECOGNISED")},pause:{entry:"recStop",on:{CLICK:"noinput"}}}},speaking:{entry:"ttsStart",on:{ENDSPEECH:"idle",SELECT:"idle",CLICK:{target:"idle",actions:R("ENDSPEECH")}},exit:"ttsStop"},fail:{}}}}},{actions:{recLogResult:function(t){console.log("U>",t.recResult[0].utterance,t.recResult[0].confidence,t.recResult[0].background)},logIntent:function(t){console.log("<< NLU intent: "+t.nluData.intent.name)}}}),A=function(t){var e=((t.state.context.tdmVisualOutputInfo||[{}]).find((function(t){return"name"===t.attribute}))||{}).value,n=((t.state.context.tdmVisualOutputInfo||[{}]).find((function(t){return"name"===t.attribute}))||{}).value,o=((t.state.context.tdmVisualOutputInfo||[{}]).find((function(t){return"image"===t.attribute}))||{}).value,r="circle";switch(!0){case t.state.matches({asrtts:"fail"})||t.state.matches({dm:"fail"}):break;case t.state.matches({asrtts:{recognising:"pause"}}):e="Click to continue";break;case t.state.matches({asrtts:"recognising"}):r="circle-recognising",e=e||"Listening...";break;case t.state.matches({asrtts:"speaking"}):r="circle-speaking",e=e||"Speaking...";break;case t.state.matches({dm:"idle"}):e="Welcome to the game! Click the circle to start",n="And this is another text",r="circle-click";break;case t.state.matches({dm:"init"}):e="Welcome to the game! Click the circle to start",r="circle-click";break;default:e=e||"\xa0"}return Object(C.jsxs)("div",{className:"control",children:[Object(C.jsx)("figure",{className:"prompt",children:o&&Object(C.jsx)("img",{src:o,alt:e})}),Object(C.jsxs)("div",{className:"status",children:[Object(C.jsx)("button",Object(a.a)({type:"button",className:r,style:{}},t)),Object(C.jsxs)("div",{className:"status-text",children:[e,n]})]})]})},I=function(t){var e=t.alternative.find((function(t){return"name"===t.attribute})).value,n=(t.alternative.find((function(t){return"image"===t.attribute}))||{}).value;return Object(C.jsxs)("figure",Object(a.a)(Object(a.a)({className:"flex"},t),{},{children:[n&&Object(C.jsx)("img",{src:n,alt:e}),Object(C.jsx)("figcaption",{children:e})]}))};function N(){var t=Object(u.b)(w,{devTools:!0,actions:{changeBackground:Object(u.a)((function(t){document.body.style.backgroundImage=n.context.recResult[0].background})),recStart:Object(u.a)((function(t){t.asr.start()})),recStop:Object(u.a)((function(t){t.asr.abort()})),ttsStart:Object(u.a)((function(t){var e='<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xmlns:mstts="http://www.w3.org/2001/mstts" xml:lang="en-US"><voice name="'.concat(t.voice.name,'">');e+='<lexicon uri="'.concat("https://emeaal.github.io/project_lt2216/lexicon.xml",'"/>'),e+="".concat(t.ttsAgenda,"</voice></speak>"),console.debug(e);var n=new t.ttsUtterance(t.ttsAgenda);console.log("S>",t.ttsAgenda),n.voice=t.voice,n.onend=function(){return a("ENDSPEECH")},t.tts.speak(n)})),ttsStop:Object(u.a)((function(t){t.tts.cancel()})),ponyfillASR:Object(u.a)((function(t,e){var n=O()({audioContext:t.audioCtx,credentials:{region:x,authorizationToken:t.azureAuthorizationToken}}).SpeechRecognition;t.asr=new n,t.asr.lang="en-US",t.asr.continuous=!0,t.asr.interimResults=!0,t.asr.onresult=function(t){var e=t.results[0];e.isFinal?a({type:"ASRRESULT",value:[{utterance:e[0].transcript,confidence:e[0].confidence,background:e[0].background}]}):a({type:"STARTSPEECH"})}}))}}),e=Object(o.a)(t,2),n=e[0],a=e[1],r=(n.context.tdmExpectedAlternatives||[]).filter((function(t){return t.visual_information})).map((function(t,e){return Object(C.jsx)(I,{state:n,alternative:t.visual_information,onClick:function(){return a({type:"SELECT",value:t.semantic_expression})}},e)}));return Object(C.jsxs)("div",{className:"App",children:[Object(C.jsx)(A,{state:n,alternative:{},onClick:function(){return a("CLICK")}}),Object(C.jsx)("div",{className:"select-wrapper",children:Object(C.jsx)("div",{className:"select",children:r})})]})}var L=function(){return fetch(new Request("https://northeurope.api.cognitive.microsoft.com/sts/v1.0/issuetoken",{method:"POST",headers:{"Ocp-Apim-Subscription-Key":"928be3e53ba647f8a9c0129ec3524237"}})).then((function(t){return t.text()}))},D=document.getElementById("root");r.render(Object(C.jsx)(N,{}),D)}},[[456,1,2]]]);
//# sourceMappingURL=main.5d7e6738.chunk.js.map